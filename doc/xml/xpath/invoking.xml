<?xml version="1.0"?> 

<!--
	description:
	
		"Invoking the stand-alone evaluator"

	library: "Gobo Eiffel XPath Library"
	copyright: "Copyright (c) 2004, Colin Adams and others"
	license: "Eiffel Forum License v2 (see forum.txt)"
	date: "$Date$"
	revision: "$Revision$"
-->

<chapter id="xpath_stand_alone_invoke">
  <chapterinfo>
    <copyright>
      <year>2004</year>
      <holder>Colin Adams and others</holder>
    </copyright>
    <author>
      <firstname>Colin</firstname>
      <surname>Adams</surname>
    </author>
    <email>colin@colina.demon.co.uk</email>
    <date>Tuesday, April 13th, 2004</date>
  </chapterinfo>
  <title>Invoking the stand-alone XPath evaluator</title>
  <para>To evaluate an XPath expression in a stand-alone environment 
   (or equivalently, from a host language of your own devising), follow the following steps:
   <itemizedlist>
     <listitem>
       <para>Inherit from <classname>XM_STRING_MODE</classname> and set the string mode
       according to your application requirements.</para>
     </listitem>
     <listitem>
       <para><ulink url="#xpath_stand_alone_invoke_create_evaluator">Create an instance of <classname>XM_XPATH_EVALUATOR</classname></ulink></para>
     </listitem>
     <listitem>
       <para><ulink url="#xpath_stand_alone_invoke_static_context">Build a static context.</ulink></para>
     </listitem>
     <listitem>
       <para><ulink url="#xpath_stand_alone_invoke_evaluate">Call <featurename>evaluate</featurename> on the evaluator.</ulink></para>
     </listitem>
     <listitem>
       <para><ulink url="#xpath_stand_alone_invoke_check_errors">Check for evaluation errors.</ulink></para>
     </listitem>
     <listitem>
       <para><ulink url="#xpath_stand_alone_invoke_results">Retrieving the results.</ulink></para>
     </listitem>
   </itemizedlist>
  </para> 
  <sect1 id="xpath_stand_alone_invoke_create_evaluator">
    <title>Creating an evaluator</title>
    <para>Currently, <classname>XM_XPATH_EVALUATOR</classname> has no creation procedures 
    <emphasis role="todo">(TODO)</emphasis>, so just call <featurecall><featurename>create</featurename></featurecall> on the object.
    <warning>This will probably change.</warning>
    </para>
  </sect1>
  <sect1 id="xpath_stand_alone_invoke_static_context">
    <title>Building a static context</title>
    <para>Before calling <featurename>evaluate</featurename>, it is first necessary to create a static context. 
      Two features are provided to do this:
      <itemizedlist>
	<listitem>
	  <para>
	    <featurecall>
	      <featurename>build_static_context</featurename>
	      <arguments>
		<argument>a_source_uri: STRING</argument>
		<argument>xpath_one_compatibility: BOOLEAN</argument>
		<argument>warnings: BOOLEAN</argument>
	      </arguments>
	    </featurecall>
	  </para>
	  <para>The first argument is the URI of an XML source, against which the XPath expression will be evaluated.</para>
	  <para>The second argument specifies if we should run in XPath 1.0 compatibility mode.</para>
	  <para>The third argument requests warnings of differences between XPath 1.0 and  XPath 1.0 compatibility mode. 
	   It is only meaningful if the second argument is True.
	  </para>
	  <para>
	    This feature parses <argument>a_source_uri</argument> as XML, and builds an instance of <classname flatshort="">XM_XPATH_TINY_DOCUMENT</classname>.
	    It sets <featurename>was_build_error</featurename> to true if any error was found, in which case <featurename>error_message</featurename>
	    will contain the text of the parse error.
	  </para>
	  <para>If no error was detected, it then creates a static context, using the document node as the context item.
	  </para>
	</listitem>
	<listitem>
	  <para>
	    <featurecall>
	      <featurename>set_static_context</featurename>
	      <arguments>
		<argument>a_static_context: XM_XPATH_STAND_ALONE_CONTEXT</argument>
	      </arguments>
	    </featurecall>
	  </para>
	  <para>This feature enables you to supply a tailored static context. 
	  You can also use it if you wish to perform an XPath evaluation without 
	  referencing an XML document (this is of rather limited usefulness, but 
	  you might want to use it for evaluating environment variables as
	  booleans, for instance).
	  </para>
	  <para>Having built your static context, you may then declare variables, if you wish.</para>
	  <para>See also<link linkend="tailoring_static_context">Tailoring the static context</link>.</para>
	</listitem>
      </itemizedlist>
    </para>
  </sect1>
  <sect1 id="xpath_stand_alone_invoke_evaluate">
    <title>Performing the evaluation</title>
    <para>The sole argument to
      <featurecall>
	<featurename>evaluate</featurename>
	<arguments>
	  <argument>an_expression_text: STRING</argument>
	</arguments>
      </featurecall>
      is the text of the XPath expression which you wish to evaluate.
    </para>
  </sect1>
  <sect1 id="xpath_stand_alone_invoke_check_errors">
    <title>Checking for evaluation errors</title>
    <para>After calling <featurename>evaluate</featurename>, check 
     <featurename>is_evaluation_in_error</featurename>
     to see if an error occured. if it did, then feature
     <featurename>error_value</featurename>
     contains the details of the error. See <classname flatshort="xm_xpath_error_value">XM_XPATH_ERROR_VALUE</classname>.
    </para>
  </sect1>
  <sect1 id="xpath_stand_alone_invoke_results">
    <title>Retrieving the results of an evaluation</title>
    <para>If the evaluation was successful, <featurename>evaluated_items: DS_LINKED_LIST [XM_XPATH_ITEM]</featurename>
     contains a list of results. These are all of type <classname flatshort="">XM_XPATH_ITEM</classname>, representing
     an XPath item. An item may either be a node (<classname flatshort="">XM_XPATH_NODE</classname>), or an atomic value
     (<classname flatshort="">XM_XPATH_ATOMIC_VALUE</classname>).
    </para>
  </sect1>
</chapter>
