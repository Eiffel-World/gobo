<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 2.0">
<title>Tables</title>
</head>

<body bgcolor="#FFFFFF">

<table border="0" width="100%">
    <tr>
        <td><font size="6"><strong>Tables</strong></font></td>
        <td align="right"><a href="list.html"><img
        src="../image/previous.gif" alt="Previous" border="0"
        width="40" height="40"></a><a href="dispenser.html"><img
        src="../image/next.gif" alt="Next" border="0" width="40"
        height="40"></a></td>
    </tr>
</table>

<hr size="1">

<p align="center"><!--webbot bot="ImageMap" startspan
rectangle=" (133,160) (237, 191)  flatshort/ds_hash_table.html"
rectangle=" (258,85) (350, 115)  flatshort/ds_resizable.html"
rectangle=" (141,84) (230, 116)  flatshort/ds_bilinear.html"
rectangle=" (22,85) (107, 116)  flatshort/ds_table.html"
rectangle=" (18,9) (110, 40)  flatshort/ds_container.html"
src="image/table.gif" border="0" width="366" height="204" --><MAP NAME="FrontPageMap0"><AREA SHAPE="RECT" COORDS="133, 160, 237, 191" HREF="flatshort/ds_hash_table.html"><AREA SHAPE="RECT" COORDS="258, 85, 350, 115" HREF="flatshort/ds_resizable.html"><AREA SHAPE="RECT" COORDS="141, 84, 230, 116" HREF="flatshort/ds_bilinear.html"><AREA SHAPE="RECT" COORDS="22, 85, 107, 116" HREF="flatshort/ds_table.html"><AREA SHAPE="RECT" COORDS="18, 9, 110, 40" HREF="flatshort/ds_container.html"></MAP><img src="image/table.gif" border="0" width="366" height="204" usemap="#FrontPageMap0"><!--webbot
bot="ImageMap" i-checksum="19539" endspan --></p>

<h2>Class <em><tt>DS_TABLE</tt></em></h2>

<p>Tables are data structures whose items are accessible by keys.
Therefore the class <a href="flatshort/ds_table.html"><font
color="#008080"><em><tt>DS_TABLE</tt></em></font></a> has two
generic parameters. As for all other container classes, the first
parameter <font color="#008080"><em><tt>G </tt></em></font>represents
the type of the items, whereas the second parameter <font
color="#008080"><em><tt>K</tt></em></font> is the type of the
keys which are associated with the items. The features provided
by class <font color="#008080"><em><tt>DS_TABLE </tt></em></font>are
very similar with some of those of class <a
href="container.html#DS_INDEXABLE"><font color="#008080"><em><tt>DS_INDEXABLE</tt></em></font></a>.
The difference comes from the fact that in <font color="#008080"><em><tt>DS_INDEXABLE
</tt></em></font>keys are contiguous integers whereas in <font
color="#008080"><em><tt>DS_TABLE </tt></em></font>keys can be of
any type, and hence not necessarily contiguous. The main features
introduced in class <font color="#008080"><em><tt>DS_TABLE </tt></em></font>are
<a href="flatshort/ds_table.html#item"><font color="#008080"><em><tt>item</tt></em></font></a>
to access items by key, <a href="flatshort/ds_table.html#put"><font
color="#008080"><em><tt>put</tt></em></font></a> to insert new
items and <a href="flatshort/ds_table.html#replace"><font
color="#008080"><em><tt>replace</tt></em></font></a> to associate
an existing key with another item, <a
href="flatshort/ds_table.html#remove"><font color="#008080"><em><tt>remove</tt></em></font></a>
to remove an item and its associated key from the table, <a
href="flatshort/ds_table.html#valid_key"><font color="#008080"><em><tt>valid_key</tt></em></font></a>
to check whether a key can be used in the table and <a
href="flatshort/ds_table.html#has"><font color="#008080"><em><tt>has</tt></em></font></a>
to check whether an item has already been inserted in the table
with a given key.</p>

<h2>Class <em><tt>DS_HASH_TABLE</tt></em></h2>

<p>One possible implementation of tables is hash tables. A hash
table is typically made up of an array where items are accessed
by integer index. Therefore the keys used in the hash tables
should provide a means to yield such integer value through a
hashing mechanism. This is exactly what feature <font
color="#008080"><em><tt>hash_code</tt></em></font> from <font
color="#008080"><em><tt>HASHABLE</tt></em></font> is for, and
therefore the second generic parameter of <a
href="flatshort/ds_hash_table.html"><font color="#008080"><em><tt>DS_HASH_TABLE</tt></em></font></a>
is contrained by <font color="#008080"><em><tt>HASHABLE</tt></em></font>.
Thanks to this implementation, features of hash tables are
usually more efficient than linked implementations since access
time in an array is bounded by a constant regardless of the
number of items in the container. However the hash code
associated with the keys is not necessarily unique, and therefore
collisions may happen and hence slow down the process. No
optimization effort has been made when writing <font
color="#008080"><em><tt>DS_HASH_TABLE</tt></em></font> in order
to take care of collisions. In particular it doesn't take
advantage of the well known algorithms using prime numbers when
collisions occur. The implementation used here is very simple and
was deemed satisfactory enough for its usage in the rest if the <em>Gobo
Eiffel </em>libraries. In particular, some benchmarks have proven
that <font color="#008080"><em><tt>DS_HASH_TABLE </tt></em></font>behaved
better than class <font color="#008080"><em><tt>HASH_TABLE</tt></em></font>
from <a href="see_also.html#EiffelBase"><em>EiffelBase</em></a>
which uses a collision-resolution algorithm based on prime
numbers. It is not clear to me whether this difference of
performance comes from the algorithm itself or from other
differences between the implementation of both hash tables, but
it is unlikely that the implementation of <font color="#008080"><em><tt>DS_HASH_TABLE
</tt></em></font>will use more sophisticated algorithms in the
future based on these observations. Another interesting remark
about efficiency is that the performance of hash tables depends
on the number of collisions that may occur in the table.
Therefore the implementation for the <font color="#008080"><em><tt>hash_code</tt></em></font>
of the keys is very important since returning often the same
value for different keys will trigger too many collisions. If the
hash table appears to be slow and the type of the keys in one of
the basic Eiffel types such as <font color="#008080"><em><tt>STRING</tt></em></font>,
it is recommended to try with another Eiffel compiler whose
implementation of <font color="#008080"><em><tt>hash_code </tt></em></font>may
be better in order to see if it makes a difference.</p>

<p>The class <font color="#008080"><em><tt>DS_HASH_TABLE </tt></em></font>provides
traversal facilities inherited from <a
href="traversal.html#DS_BILINEAR"><font color="#008080"><em><tt>DS_BILINEAR</tt></em></font></a>.
Although all items will be visited once and only once during a
traversal, they will be traversed in an unpredictable order and
subsequent traversals may traverse the items in different orders.
This is because a hash table is not an ordered containters as can
a list be. Items are not inserted before or after other items in
the hash table but based on a hashing mechanism and
collision-resolution algorithm. Therefore, altering the hash
table by adding or removing items or by resizing the table may
change the order of the items and hence will invalidate current
traversals. For this reason, most of these routines will move <font
color="#008080"><em><tt>off </tt></em></font>all existing cursors
currently traversing the hash table (see the header comments of
these routines for details).</p>

<p>As you may now realize after reading the first paragraph
above, the performance of hash tables is one of their <em>raison
d'être</em>. This had of course to be taken into account when
implementing the routines inherited from <font color="#008080"><em><tt>DS_TABLE</tt></em></font>.
Because of the precondition of <a
href="flatshort/ds_hash_table.html#item"><font color="#008080"><em><tt>item</tt></em></font></a>
which states that in order to be able to query an item associated
with a given key, that item has to exist in the first place, one
has to write:</p>

<blockquote>
    <pre><font color="#000080"><em><strong>if</strong></em></font><em> table</em>.<em>has </em>(<em>k</em>)<em> </em><font
color="#000080"><em><strong>then</strong></em></font><em>
    v </em>:= <em>table</em>.<em>item </em>(<em>k</em>)<em>
</em><font color="#000080"><em><strong>else</strong></em></font><em>
    ...
</em><font color="#000080"><em><strong>end</strong></em></font></pre>
</blockquote>

<p>However, both <a href="flatshort/ds_hash_table.html#has"><font
color="#008080"><em><tt>has</tt></em></font></a><font
color="#008080"><em><tt> </tt></em></font>and <a
href="flatshort/ds_hash_table.html#item"><font color="#008080"><em><tt>item</tt></em></font></a><font
color="#008080"><em><tt> </tt></em></font>will have to compute
the hash code of <font color="#008080"><em><tt>k</tt></em></font>
and deal with possible collisions in the hash table. In other
words we do twice the same thing. The solution adopted in the
current implementation of <font color="#008080"><em><tt>DS_HASH_TABLE
</tt></em></font>is to keep track of the result of last hashing
operation in the hash table. Therefore, in the code above, most
of the work of accessing the item at key <font color="#008080"><em><tt>k</tt></em></font>
will be done only once in the routine <font color="#008080"><em><tt>has</tt></em></font>,
and <font color="#008080"><em><tt>item </tt></em></font>will
realize that the key given as argument is the same and hence
avoid calling the hashing mechanism again.</p>

<p>Another solution to avoid that would have been to get rid of
the precondition in <font color="#008080"><em><tt>item </tt></em></font>and
return <em>Void</em> when there is no item associated with key <font
color="#008080"><em><tt>k</tt></em></font>. However this solution
goes against the principle of <em>Design by Contract</em> since
getting <em>Void</em> could either mean that there is no item for
key <font color="#008080"><em><tt>k</tt></em></font> or that
there is actually one which happens to be <em>Void</em>.
Therefore this solution has not been adopted in <font
color="#008080"><em><tt>DS_HASH_TABLE </tt></em></font>but a
better designed alternative also based on the <em>try-and-see</em>
principle is available:</p>

<blockquote>
    <pre><em>table</em>.<em>search </em>(<em>k</em>)
<font color="#000080"><em><strong>if</strong></em></font><em> table</em>.<em>found </em><font
color="#000080"><em><strong>then</strong></em></font><em>
    v </em>:= <em>table</em>.<em>found_item
</em><font color="#000080"><em><strong>else</strong></em></font><em>
    ...
</em><font color="#000080"><em><strong>end</strong></em></font></pre>
</blockquote>

<p>Both code excerpts should have the same execution time
performance thanks to <font color="#008080"><em><tt>DS_HASH_TABLE</tt></em></font>'s
internal optimizations. Using one or the other is just a question
of taste. I personally prefer the first pattern.</p>

<hr size="1">

<table border="0" width="100%">
    <tr>
        <td><address>
            <font size="2"><b>Copyright © 1999</b></font><font
            size="1"><b>, </b></font><font size="2"><strong>Eric
            Bezault</strong></font><strong> </strong><font
            size="2"><br>
            <strong>mailto:</strong></font><a
            href="mailto:ericb@gobosoft.com"><font size="2">ericb@gobosoft.com</font></a><font
            size="2"><br>
            <strong>http:</strong></font><a
            href="http://www.gobosoft.com"><font size="2">//www.gobosoft.com</font></a><font
            size="2"><br>
            <strong>Last Updated:</strong> 29 August 1999</font><br>
            <!--webbot bot="PurpleText"
            preview="
$Date$ 
$Revision$"
            --> 
        </address>
        </td>
        <td align="right" valign="top"><a
        href="http://www.gobosoft.com"><img
        src="../image/home.gif" alt="Home" border="0" width="40"
        height="40"></a><a href="index.html"><img
        src="../image/toc.gif" alt="Toc" border="0" width="40"
        height="40"></a><a href="list.html"><img
        src="../image/previous.gif" alt="Previous" border="0"
        width="40" height="40"></a><a href="dispenser.html"><img
        src="../image/next.gif" alt="Next" border="0" width="40"
        height="40"></a></td>
    </tr>
</table>
</body>
</html>
